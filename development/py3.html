<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Supporting Python 2 and Python 3 &mdash; scikit-bio 0.1.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootswatch-3.1.0/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-3.1.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="scikit-bio 0.1.1 documentation" href="../index.html" />
    <link rel="prev" title="skbio.util.testing.get_data_path" href="../generated/skbio.util.testing.get_data_path.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>
  
  <a href="https://github.com/biocore/scikit-bio"
     class="visible-desktop hidden-xs"><img
    id="gh-banner"
    style="position: absolute; top: 50px; right: 0; border: 0;"
    src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"
    alt="Fork me on GitHub"></a>
  <script>
    // Adjust banner height.
    $(function () {
      var navHeight = $(".navbar .container").css("height");
      $("#gh-banner").css("top", navHeight);
    });
  </script>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          scikit-bio docs</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            <li class="divider-vertical"></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../core.alignment.html">Sequence collections and alignments (<tt class="docutils literal"><span class="pre">skbio.core.alignment</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.sequence.html">Biological sequences (<tt class="docutils literal"><span class="pre">skbio.core.sequence</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.distance.html">Dissimilarity and distance matrices (<tt class="docutils literal"><span class="pre">skbio.core.distance</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.exception.html">Exceptions (<tt class="docutils literal"><span class="pre">skbio.core.exception</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.warning.html">Warnings (<tt class="docutils literal"><span class="pre">skbio.core.warning</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.genetic_code.html">Genetic Code (<tt class="docutils literal"><span class="pre">skbio.core.genetic_code</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.tree.html">Tree representations (<tt class="docutils literal"><span class="pre">skbio.core.tree</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.workflow.html">Constructing workflows (<tt class="docutils literal"><span class="pre">skbio.core.workflow</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core.ssw.html">Performing Striped Smith Waterman Alignments (<tt class="docutils literal"><span class="pre">skbio.core.ssw</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../draw.distributions.html">Distribution visualizations (<tt class="docutils literal"><span class="pre">skbio.draw.distributions</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format.sequences.html">Format biological sequences (<tt class="docutils literal"><span class="pre">skbio.format.sequences</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math.diversity.alpha.html">Alpha diversity measures (<tt class="docutils literal"><span class="pre">skbio.math.diversity.alpha</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math.stats.distance.html">Distance-based statistics (<tt class="docutils literal"><span class="pre">skbio.math.stats.distance</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math.stats.spatial.html">Spatial Statistics (<tt class="docutils literal"><span class="pre">skbio.math.stats.spatial</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math.stats.ordination.html">Ordination methods (<tt class="docutils literal"><span class="pre">skbio.math.stats.ordination</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math.gradient.html">Gradient analyses (<tt class="docutils literal"><span class="pre">skbio.math.gradient</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math.subsample.html">Subsampling (<tt class="docutils literal"><span class="pre">skbio.math.subsample</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parse.sequences.html">Parse biological sequences (<tt class="docutils literal"><span class="pre">skbio.parse.sequences</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../util.io.html">I/O utils (<tt class="docutils literal"><span class="pre">skbio.util.io</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../util.misc.html">Miscellaneous Utilities (<tt class="docutils literal"><span class="pre">skbio.util.misc</span></tt>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../util.testing.html">Testing utilities (<tt class="docutils literal"><span class="pre">skbio.util.testing</span></tt>)</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">Supporting Python 2 and Python 3</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Supporting Python 2 and Python 3</a><ul>
<li><a class="reference internal" href="#importing-future">Importing __future__</a></li>
<li><a class="reference internal" href="#iterators">Iterators</a><ul>
<li><a class="reference internal" href="#builtins">Builtins</a></li>
<li><a class="reference internal" href="#advancing-an-iterator">Advancing an iterator</a></li>
<li><a class="reference internal" href="#implementing-new-iterators">Implementing new iterators</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changes-in-the-standard-library">Changes in the standard library</a><ul>
<li><a class="reference internal" href="#stringio-and-bytesio">StringIO and BytesIO</a></li>
</ul>
</li>
<li><a class="reference internal" href="#text-vs-bytes">Text vs bytes</a><ul>
<li><a class="reference internal" href="#a-brief-introduction-unicode-utf-8-ascii">A brief introduction: Unicode, UTF-8, ASCII...</a></li>
<li><a class="reference internal" href="#text-processing">Text processing</a></li>
<li><a class="reference internal" href="#gotchas">Gotchas</a></li>
</ul>
</li>
<li><a class="reference internal" href="#instance-checking-basestring-str-unicode-bytes-long-int">Instance checking: basestring, str, unicode, bytes, long, int</a><ul>
<li><a class="reference internal" href="#strings">Strings</a></li>
<li><a class="reference internal" href="#numbers">Numbers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-comparisons">Implementing comparisons</a></li>
<li><a class="reference internal" href="#other-modules">Other modules</a><ul>
<li><a class="reference internal" href="#numpy">Numpy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="supporting-python-2-and-python-3">
<h1>Supporting Python 2 and Python 3<a class="headerlink" href="#supporting-python-2-and-python-3" title="Permalink to this headline">¶</a></h1>
<p>skbio simultaneously supports Python 2.7 and 3.3+ by writing code that
works unchanged in both major versions.</p>
<p>As a compatibility layer, we&#8217;re using the future project
<a class="reference external" href="http://python-future.org/">http://python-future.org/</a> which &#8220;allows you to use a single, clean
Python 3.x-compatible codebase to support both Python 2 and Python 3
with minimal overhead&#8221;. It includes functionality from &#8220;six, IPython,
Jinja2, Django, and Pandas&#8221;.</p>
<p>So far, this notes are based on issues that have appeared when porting
skbio, so it is not a complete guide. Refer to the <a class="reference external" href="https://docs.python.org/3/howto/pyporting.html">official porting
guide</a> and the
<a class="reference external" href="http://python-future.org/">python-future docs</a> for more
information.</p>
<div class="section" id="importing-future">
<h2>Importing __future__<a class="headerlink" href="#importing-future" title="Permalink to this headline">¶</a></h2>
<p>For consistency across versions, every Python file should start with
the following imports:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># ----------------------------------------------------------------------------</span>
<span class="c"># Copyright (c) 2013--, scikit-bio development team.</span>
<span class="c">#</span>
<span class="c"># Distributed under the terms of the Modified BSD License.</span>
<span class="c">#</span>
<span class="c"># The full license is in the file COPYING.txt, distributed with this software.</span>
<span class="c"># ----------------------------------------------------------------------------</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
</pre></div>
</div>
</div>
<div class="section" id="iterators">
<h2>Iterators<a class="headerlink" href="#iterators" title="Permalink to this headline">¶</a></h2>
<div class="section" id="builtins">
<h3>Builtins<a class="headerlink" href="#builtins" title="Permalink to this headline">¶</a></h3>
<p>Builtin iterators in Python 2 usually return lists, and have an
alternative that returns and iterator (i.e., <cite>range</cite> and <cite>xrange</cite>,
<cite>items</cite> and <cite>iteritems</cite>). In Python 3, only the iterator version
exists but it uses the list-returning name (i.e., <cite>range</cite> and
<cite>items</cite>).</p>
<p>When iterating over the resulting object, the recommended approach
depends on efficiency concerns:</p>
<ul class="simple">
<li>If iteration only happens over a few items, you can use the
functions that exist both in Python 2 and Python 3.</li>
<li>If the number of iterations can be large and efficiency is
important, use the future package.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="41%" />
<col width="29%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Small # of
iterations (returns
lists in py2,
iterators in py3)</td>
<td>Efficient versions
(always iterators)</td>
<td>Notes</td>
</tr>
<tr class="row-even"><td><cite>zip</cite></td>
<td><cite>future.builtins.zip</cite></td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><cite>range</cite></td>
<td><cite>future.builtins.range</cite></td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><cite>map</cite></td>
<td><cite>future.builtins.map</cite></td>
<td>Prefer lists
comprehensions or
for loops in
general. Avoid
calling functions
that cause side
effects when using
map. Gotcha: Py3&#8217;s
<cite>map</cite> stops when the
shortest iterable is
exhausted, but Py2&#8217;s
pads them with
<cite>None</cite> till the
longest iterable is
exhausted.</td>
</tr>
<tr class="row-odd"><td><cite>filter</cite></td>
<td><cite>future.builtins.filter</cite></td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><cite>functools.reduce</cite></td>
<td><cite>functools.reduce</cite></td>
<td>Avoid using the
global reduce
available in Py2 (it
is the same as the
<cite>functools</cite> one)</td>
</tr>
<tr class="row-odd"><td><cite>d.items()</cite></td>
<td><cite>future.utils.viewitems(d)</cite></td>
<td>Efficient iteration
over d <em>and</em>
set-like behaviour</td>
</tr>
<tr class="row-even"><td><cite>d.values()</cite></td>
<td><cite>future.utils.viewvalues(d)</cite></td>
<td>Efficient iteration
over d <em>and</em>
set-like behaviour</td>
</tr>
<tr class="row-odd"><td><cite>d.keys()</cite></td>
<td><cite>future.utils.viewkeys(d)</cite></td>
<td>Hardly ever needed,
as iterating over a
dictionary yields
keys (thus sorted(d)
returns the sorted
keys).</td>
</tr>
</tbody>
</table>
<p>When not directly iterating over an iterator, don&#8217;t write code that
relies on list-like behaviour: you may need to cast it explicitly. The
following snippets show some possible issues:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>  <span class="c"># succeeds in Py2 (list concatenation), TypeError in Py3</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="n">s</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="mi">1</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c"># True (membership testing in a list is an O(n) bad idea)</span>
<span class="mi">0</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c"># True in Py2, False in Py3</span>
</pre></div>
</div>
<p>In Py2, <cite>s</cite> is a list, so clearly <cite>(1 in [0, 1]) == True</cite> and <cite>(0 in
[0, 1]) == True</cite>. In Py3, <cite>s</cite> is an iterator and the items it yields
are discarded. Let&#8217;s see an example with a generator to try and make
it more clear:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>  <span class="c"># print will let us see the iteration</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c"># Starts iterating over s...</span>
<span class="go">0</span>
<span class="go">1                   # ...till it finds (1, None)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">in</span> <span class="n">s</span>  <span class="c"># Continues iterating over s</span>
<span class="go">2                   # s is exhausted</span>
<span class="go">False               # but (0, None) isn&#39;t there</span>
</pre></div>
</div>
</div>
<div class="section" id="advancing-an-iterator">
<h3>Advancing an iterator<a class="headerlink" href="#advancing-an-iterator" title="Permalink to this headline">¶</a></h3>
<p>Always use the next function, which is available from Python 2.6
onwards. Never call the next method, which doesn&#8217;t exist in Py3.</p>
</div>
<div class="section" id="implementing-new-iterators">
<h3>Implementing new iterators<a class="headerlink" href="#implementing-new-iterators" title="Permalink to this headline">¶</a></h3>
<p>Implement the <cite>__next__</cite> special method, like in Py3, and decorate the
class:</p>
<div class="highlight-python"><div class="highlight"><pre>from future.utils import implements_iterator

@implements_iterator
class ParameterIterBase(object):
def __next__(self):
    return next(self._generator)
</pre></div>
</div>
<p>It is also possible to subclass from <cite>future.builtins.object</cite>. In this
case, no decorator is needed.</p>
</div>
</div>
<div class="section" id="changes-in-the-standard-library">
<h2>Changes in the standard library<a class="headerlink" href="#changes-in-the-standard-library" title="Permalink to this headline">¶</a></h2>
<p>To deal with modules that live under a different place, future
provides a context manager:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Example from future&#39;s documentation</span>
<span class="kn">from</span> <span class="nn">future</span> <span class="kn">import</span> <span class="n">standard_library</span>

<span class="k">with</span> <span class="n">standard_library</span><span class="o">.</span><span class="n">hooks</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">http.client</span> <span class="kn">import</span> <span class="n">HttpConnection</span>
    <span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">filterfalse</span>
    <span class="kn">import</span> <span class="nn">html.parser</span>
    <span class="kn">import</span> <span class="nn">queue</span>
</pre></div>
</div>
<div class="section" id="stringio-and-bytesio">
<h3>StringIO and BytesIO<a class="headerlink" href="#stringio-and-bytesio" title="Permalink to this headline">¶</a></h3>
<p>In Py2 there are three flavours of StringIO: a pure Python module
(StringIO), an accelerated version (cStringIO), and another one in the
io module. They all behave in a slightly different way, with differnt
memory and performance characteristics. So far, we&#8217;re using:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">future.utils.six</span> <span class="kn">import</span> <span class="n">StringIO</span>
</pre></div>
</div>
<p>It refers to <cite>io.StringIO</cite> in Py3, and <cite>StringIO.StringIO</cite> in Py2.</p>
<p>If you need a binary file-like object (see the Text vs bytes section),
use <cite>future.utils.six.BytesIO</cite>, which refers to <cite>io.BytesIO</cite> in Py3,
and <cite>StringIO.StringIO</cite> in Py2.</p>
</div>
</div>
<div class="section" id="text-vs-bytes">
<h2>Text vs bytes<a class="headerlink" href="#text-vs-bytes" title="Permalink to this headline">¶</a></h2>
<p>This is a fundamental change between Py2 and Py3. It is very important
to always distinguish text from bytes.</p>
<p>String literals that are to be treated as bytes need the <cite>b</cite>
prefix. String literals that are text need either the <cite>u</cite> prefix or
<cite>from __future__ import unicode_literals</cite> at the top.</p>
<div class="section" id="a-brief-introduction-unicode-utf-8-ascii">
<h3>A brief introduction: Unicode, UTF-8, ASCII...<a class="headerlink" href="#a-brief-introduction-unicode-utf-8-ascii" title="Permalink to this headline">¶</a></h3>
<p>A string can be seen as a sequence of characters. According to the
Unicode standard, each character is represented by a code point (a
number). For example, character <cite>ñ</cite> is represented by the Unicode code
point <cite>U+00F1</cite>. Code points are still abstract and can be stored in a
number of ways, including even little or big endian formats. There are
many encodings that map code points to byte values (encode) and back
(decode). Three important ones are ASCII, UTF-8 and latin-1:</p>
<ul class="simple">
<li>ASCII is a 7 bit encoding that can handle a very limited range of
Unicode code points (not even the one corresponding to character
<cite>ñ</cite>).</li>
<li>UTF-8 is an encoding that can represent every Unicode character. It
is ASCII-compatible because code points that can also be represented
by ASCII are mapped to the same byte value by UTF-8 and ASCII. <cite>ñ</cite>
is represented by the byte sequence <cite>xC3xB1</cite>.</li>
<li>latin-1 is an ASCII-compatible 8 bit encoding that maps the first
256 Unicode code points to their byte values. That is, the Unicode
code point <cite>U+00F1</cite> (character <cite>ñ</cite>) is directly encoded as <cite>0xF1</cite> in
latin-1. The Py2 <cite>str</cite> type loosely worked by assuming everything
was encoded in latin-1.</li>
</ul>
</div>
<div class="section" id="text-processing">
<h3>Text processing<a class="headerlink" href="#text-processing" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div>There Ain&#8217;t No Such Thing As Plain Text.  &#8211; Joel Spolsky, <a class="reference external" href="http://www.joelonsoftware.com/articles/Unicode.html">The
Absolute Minimum Every Software Developer Absolutely, Positively
Must Know About Unicode and Character Sets (No Excuses!)</a>, 2003.</div></blockquote>
<p>After going through Nick Coghlan&#8217;s <a class="reference external" href="https://ncoghlan_devs-python-notes.readthedocs.org/en/latest/python3/text_file_processing.html">&#8220;Processing Text Files in Python
3&#8221;</a>
I think the way forward is to process ASCII-like files (fasta, fastq)
as binary files, and decode to strings some parts, if necessary. This
is faster than processing them as text files, especially in Py3. In
fact, it seems (from functions like <cite>_phred_to_ascii*</cite>) that these
formats are in fact mixed binary and ASCII, which I think puts us in
the same place as people dealing with <a class="reference external" href="https://ncoghlan_devs-python-notes.readthedocs.org/en/latest/python3/binary_protocols.html">network protocols</a>:
it&#8217;s more cumbersome to do in Py3, especially before Python 3.5
arrives, which will <a class="reference external" href="http://legacy.python.org/dev/peps/pep-0460/">reintroduce binary string interpolation</a>).</p>
</div>
<div class="section" id="gotchas">
<h3>Gotchas<a class="headerlink" href="#gotchas" title="Permalink to this headline">¶</a></h3>
<p>Comparing bytes and text strings always returns <cite>False</cite> in Python 3
(as they&#8217;re incompatible types, and comparisons are required to
succeed by the language):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="s">&#39;GATCAT&#39;</span> <span class="o">==</span> <span class="s">&#39;GATCAT&#39;</span>
<span class="go">False</span>
</pre></div>
</div>
<p>Calling <cite>str</cite> on a bytes instance returns a string with the <cite>b</cite> prefix
and quotes, which will give unexpected results when using string
formatting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;Sequence {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;GATCAT&#39;</span><span class="p">)</span>
<span class="go">&quot;Sequence b&#39;GATCAT&#39;&quot;</span>
</pre></div>
</div>
<p>If you actually want to construct a text string, bytes objects need to
be <em>decoded</em> into text. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&quot;Sequence {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;GATCAT&#39;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>If you want to efficiently construct a byte string, the most
convenient way may be to call <cite>b&#8217;&#8216;.join(iterable of byte strings)</cite>,
though there are other options like using <cite>io.BytesIO</cite> or
<cite>bytearray</cite>. For a very small number of byte strings, it may be OK to
use the <cite>+</cite> operator.</p>
<p>Run python with the <cite>-b</cite> flag to detect these two bug-prone usages,
and <cite>-bb</cite> to turn them into exceptions.</p>
</div>
</div>
<div class="section" id="instance-checking-basestring-str-unicode-bytes-long-int">
<h2>Instance checking: basestring, str, unicode, bytes, long, int<a class="headerlink" href="#instance-checking-basestring-str-unicode-bytes-long-int" title="Permalink to this headline">¶</a></h2>
<div class="section" id="strings">
<h3>Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h3>
<p>When testing if a variable is a string use
<cite>future.utils.six.string_types</cite>. It refers to <cite>basestring</cite> in Py2 and
<cite>str</cite> in Py3. <cite>binary_type</cite> and <cite>text_type</cite> are also available.</p>
</div>
<div class="section" id="numbers">
<h3>Numbers<a class="headerlink" href="#numbers" title="Permalink to this headline">¶</a></h3>
<p>The <cite>long</cite> type no longer exists in Py2. To test if a number is an
integer (<cite>int</cite> or <cite>long</cite> in Py2, <cite>int</cite> in Py3), compare it to
the abstract base class <cite>Integral</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Integral</span>
<span class="nb">isinstance</span><span class="p">(</span><span class="n">quality</span><span class="p">,</span> <span class="n">Integral</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="implementing-comparisons">
<h2>Implementing comparisons<a class="headerlink" href="#implementing-comparisons" title="Permalink to this headline">¶</a></h2>
<p>If the class you&#8217;re defining has a <a class="reference external" href="http://en.wikipedia.org/wiki/Total_order">total ordering</a>, either use
<a class="reference external" href="https://docs.python.org/2.7/library/functools.html#functools.total_ordering">functools.total_ordering</a>
or implement all rich comparison methods if comparison performance is
a bottleneck. Don&#8217;t implement <cite>__cmp__</cite>, which was removed in Py3.</p>
<p>However, usually only equality is important and you should only define
<cite>__eq__</cite>. While compatibility with Py2 is kept, <cite>__ne__</cite> needs to be
implemented too:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Required in Py2.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</pre></div>
</div>
<p>Otherwise, using the operator <cite>!=</cite> will lead to unexpected results in
Py2 because it will compare identity, not equality:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>

<span class="k">print</span><span class="p">(</span><span class="n">Foo</span><span class="p">()</span> <span class="o">!=</span> <span class="n">Foo</span><span class="p">())</span>
</pre></div>
</div>
<p>That prints <cite>True</cite> in Py2 (because each instance has a different <cite>id</cite>)
but prints <cite>False</cite> in Py3 (the opposite of what <cite>__eq__</cite> returns,
which is the desired behaviour).</p>
<p>Always test that both <cite>==</cite> and <cite>!=</cite> are behaving correctly, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">gc_1</span> <span class="o">=</span> <span class="n">GeneticCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sgc</span><span class="p">)</span>
    <span class="n">gc_2</span> <span class="o">=</span> <span class="n">GeneticCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sgc</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">gc_1</span><span class="p">,</span> <span class="n">gc_2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_ne</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">gc_1</span> <span class="o">=</span> <span class="n">GeneticCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sgc</span><span class="p">)</span>
    <span class="n">gc_2</span> <span class="o">=</span> <span class="n">GeneticCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sgc</span><span class="p">)</span>
    <span class="c"># Explicitly using !=</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">gc_1</span> <span class="o">!=</span> <span class="n">gc_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="other-modules">
<h2>Other modules<a class="headerlink" href="#other-modules" title="Permalink to this headline">¶</a></h2>
<div class="section" id="numpy">
<h3>Numpy<a class="headerlink" href="#numpy" title="Permalink to this headline">¶</a></h3>
<p>Try to avoid setting dtypes to a string (i.e., use <cite>dtype=np.float64</cite>
instead of <cite>dtype=&#8217;float&#8217;</cite>, etc). It is may be safe, but some warnings
were raised when running Python with the <cite>-b</cite> flag. Also, field names
in structured dtypes need to be bytes (<cite>str</cite> type) in Py2, but text
(<cite>str</cite> type) in Py3 (<a class="reference external" href="https://github.com/numpy/numpy/issues/2407">issue #2407</a>).</p>
</div>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p><cite>unittest.assertEquals</cite> is deprecated. Use <cite>unittest.assertEqual</cite>
instead. The complete list of deprecated testing methods is <a class="reference external" href="https://docs.python.org/3.4/library/unittest.html#deprecated-aliases">here</a></p>
</div>
</div>


    </div>
      
  </div>
</div>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2014--, scikit-bio development team.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-6636235-9', 'scikit-bio.org');
    ga('send', 'pageview');
  </script>

  </body>
</html>